SELECT
    -- üîë Keys
    PRSCDT.SPHMLCT,
    SPHMLCT.NAME AS SPHMLCT_NAME,
    PRSCDT.PRSCNO,
    PRSCDT.ITEMNO,
    PRSCDT.PACKSEQ,

    -- üë§ Patient Info
    PRSC.HN,
    PRSC.AN,
    PRSC.VN,
    PRSC.PTTYPE,

    -- üè• Visit Info
    PRSC.PRFRLCT,
    PRFRLCT.NAME AS PRFRLCT_NAME,

    DATEADD(SECOND, CAST(PRSC.PRSCTIME AS INT) % 100,
        DATEADD(MINUTE, (CAST(PRSC.PRSCTIME AS INT) / 100) % 100,
            DATEADD(HOUR, CAST(PRSC.PRSCTIME AS INT) / 10000, PRSC.PRSCDATE)
        )
    ) AS PRSCDATETIME,

    -- üíä Medication Info
    PRSCDT.MEDITEM,
    PRSCDT.QTY,
    MEDITEMDIS.MEDCODE,
    MEDITEMDIS.MEDFORM,
    MEDITEMDIS.MALE,

    -- üßæ Usage Instructions
    PRSCDT.MEDUSETYPE,
    MEDUSETYPE.NAME AS MEDUSETYPENAME,

    PRSCDT.MEDUSEQTY,
    MEDUSEQTY.NAME AS MEDUSEQTYNAME,

    PRSCDT.MEDUSEUNIT,
    MEDUSEUNIT.NAME AS MEDUSEUNITNAME,

    PRSCDT.MEDUSETIME,
    MEDUSETIME.NAME AS MEDUSETIMENAME,

    PRSCDT.MEDSYMPTOM,
    MEDSYMPTOM.NAME AS MEDSYMPTOMNAME,

    -- üì¶ Order Details
    PRSCDT.ICSALE,
    PRSCDT.ORDERCODE,
    PRSCDT.INCOME,
    PRSCDT.PRSCDTEXT,
    PRSCDT.PTTYPEEXT,

    -- üßæ Dispensing / Order Metadata
    PRSCTYPEPT.NAME,
    PRSC.PRSCST,
    PRSC.TOTALITEM,
    PRSC.PRSCAMT,
    PRSC.TYPE_OF_ORDER,
    PRSC.RUNNING_NO,
    PRSC.FINLCT,
    FINLCT.NAME AS FINLCT_NAME,
    PRSC.FINREFNO,

    -- üìÜ Timestamps as DATETIME
    DATEADD(SECOND, CAST(PRSC.CONFIRMTIME AS INT) % 100,
        DATEADD(MINUTE, (CAST(PRSC.CONFIRMTIME AS INT) / 100) % 100,
            DATEADD(HOUR, CAST(PRSC.CONFIRMTIME AS INT) / 10000, PRSC.CONFIRMDATE)
        )
    ) AS CONFIRMEDDATETIME,

    DATEADD(SECOND, CAST(PRSC.CHKTIME AS INT) % 100,
        DATEADD(MINUTE, (CAST(PRSC.CHKTIME AS INT) / 100) % 100,
            DATEADD(HOUR, CAST(PRSC.CHKTIME AS INT) / 10000, PRSC.CHKDATE)
        )
    ) AS CHECKEDDATETIME,

    DATEADD(SECOND, CAST(PRSC.OTPTIME AS INT) % 100,
        DATEADD(MINUTE, (CAST(PRSC.OTPTIME AS INT) / 100) % 100,
            DATEADD(HOUR, CAST(PRSC.OTPTIME AS INT) / 10000, PRSC.OTPDATE)
        )
    ) AS OTPDATETIME,

    PRSC.CANCELDATE,

    -- üë®‚Äç‚öïÔ∏è Staff & Locations
    PRSCDT.ISSUESTF,
    PRSC.C_PHLOC,

    -- üïí Audit Columns
    PRSCDT.FIRSTDATE,
    PRSC.STATUS

FROM {{ source('ddc_internal', 'PRSCDT') }} PRSCDT

LEFT JOIN {{ source('ddc_internal', 'PRSC') }} PRSC
    ON PRSC.PRSCNO = PRSCDT.PRSCNO
   AND PRSC.SPHMLCT = PRSCDT.SPHMLCT

LEFT JOIN {{ source('ddc_internal', 'MEDITEMDIS') }} MEDITEMDIS
    ON PRSCDT.MEDITEM = MEDITEMDIS.MEDITEM

LEFT JOIN {{ source('ddc_internal', 'MEDUSEQTY') }} MEDUSEQTY
    ON PRSCDT.MEDUSEQTY = MEDUSEQTY.MEDUSEQTY

LEFT JOIN {{ source('ddc_internal', 'MEDUSETYPE') }} MEDUSETYPE
    ON PRSCDT.MEDUSETYPE = MEDUSETYPE.MEDUSETYPE
   AND MEDITEMDIS.MEDFORM = MEDUSETYPE.MEDFORM

LEFT JOIN {{ source('ddc_internal', 'MEDUSEUNIT') }} MEDUSEUNIT
    ON PRSCDT.MEDUSEUNIT = MEDUSEUNIT.MEDUSEUNIT

LEFT JOIN {{ source('ddc_internal', 'MEDUSETIME') }} MEDUSETIME
    ON PRSCDT.MEDUSETIME = MEDUSETIME.MEDUSETIME

LEFT JOIN {{ source('ddc_internal', 'MEDSYMPTOM') }} MEDSYMPTOM
    ON PRSCDT.MEDSYMPTOM = MEDSYMPTOM.MEDSYMPTOM

LEFT JOIN {{ source('ddc_internal', 'PRSCTYPEPT')}} PRSCTYPEPT 
    ON PRSCTYPEPT.PRSCTYPEPT = PRSC.PRSCTYPEPT

LEFT JOIN {{ source('ddc_internal', 'LCT')}} SPHMLCT 
    ON PRSCDT.SPHMLCT = SPHMLCT.LCT

LEFT JOIN {{ source('ddc_internal', 'LCT')}} PRFRLCT 
    ON PRSC.PRFRLCT = PRFRLCT.LCT

LEFT JOIN {{ source('ddc_internal', 'LCT')}} FINLCT 
    ON PRSC.FINLCT = FINLCT.LCT

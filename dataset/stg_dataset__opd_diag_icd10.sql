SELECT
PTDIAG.HN
, DATEADD(SECOND, CAST(PTDIAG.VSTTIME AS INT) % 100, 
    DATEADD(MINUTE, (CAST(PTDIAG.VSTTIME AS INT) / 100) % 100, 
        DATEADD(HOUR, CAST(PTDIAG.VSTTIME AS INT) / 10000, PTDIAG.VSTDATE)
    )
) AS VSTDATETIME
, PTDIAG.CLINICLCT
, PTDIAG.ITEMNO
, PTDIAG.AN
, PTDIAG.VN
, PTDIAG.ICD10
, ICD10.ICD10WHO
, ICD10.NAME AS DISEASE_NAME
, PTDIAG.DIAGTYPE
, DIAGTYPE.NAME AS DIAGTYPE_NAME
, PTDIAG.DIAGKEY
, PTDIAG.FIRSTDATE
FROM 
{{ source('ddc_internal', 'PTDIAG') }} PTDIAG
LEFT JOIN {{ source('ddc_internal', 'ICD10') }} ICD10 ON PTDIAG.ICD10 = ICD10.ICD10
LEFT JOIN {{ source('ddc_internal', 'DIAGTYPE') }} DIAGTYPE ON PTDIAG.DIAGTYPE = DIAGTYPE.DIAGTYPE